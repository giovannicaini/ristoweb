{% extends "pages/abstract/default.html.twig" %}

{% set page_active = "home" %}

{# Overrides blocks in head of base template #}
{% block page_title %}GESTIONE COMANDE{% endblock %}

{% block page_description %}Evento Attivo: <b>{{evento.nome}} - {{evento.data|date('d/m/Y')}}</b>{% endblock %}

{% block body_matter %}
<div class="row mb-3">
<div class="col-lg-12">
	<a class="btn btn-xs btn-warning float-left js-cambia-evento-corrente">Cambia Evento Corrente</a>
	<a class="btn btn-xs btn-primary float-left ml-3" href="{{site.uri.public}}/comande/riepilogo">Stampa Riepilogo Comande</a>
</div>
</div>
	<div class="row">
		<div class="col-lg-12">
			<div class="card card-primary card-outline">
				<div class="card-header">
					<h5 class="card-title m-0">Comande</h5>
					<a class="btn btn-success float-right js-nuova-comanda">+ Nuova Comanda</a>
				</div>
				<div class="card-body">
					<div class="table-responsive">
					<table class="table table-striped table-bordered">
						<thead>
							<tr>
								<th style="width: 10px">N.Ordine</th>
								<th style="text-align:center">Nominativo</th>
								<th style="text-align:center">Cassiere</th>
								<th style="text-align:center">Totale</th>
								<th style="text-align:center">Pagato</th>
								<th style="text-align:center;width: 40px">Stato</th>
								<th style="text-align:center; width: 40px">Azioni</th>
							</tr>
						</thead>
						<tbody>
						{% set a = 0 %}
						{% set b = 0 %}
						{% for comanda in comande %}
							<tr>
							{% set a = a + comanda.pagato %}
							{% set b = b + comanda.totale %}
								<td style="vertical-align:middle; text-align:center">{{comanda.n_ordine}}</td>
								<td style="vertical-align:middle;">{{comanda.nominativo}}</td>
								<td style="vertical-align:middle;">{{comanda.cassiere.first_name}} {{comanda.cassiere.last_name}}</td>
								<td style="vertical-align:middle; text-align:right">{{comanda.totale}} €</td>
								<td style="vertical-align:middle; text-align:right">{%if comanda.pagato %}{{comanda.pagato}} €{% endif %}</td>
								<td style="vertical-align:middle; text-align:center">
									{% if comanda.stato == "aperta"%}
										<span class="badge bg-danger">Aperta</span>
									{% elseif comanda.stato == "pagata"%}
										<span class="badge bg-success">Pagata</span>
									{% elseif comanda.stato == "compilata"%}
										<span class="badge bg-warning">Compilata</span>
									{% endif %}
								</td>
								<td style="vertical-align:middle; text-align:center">
									<div class="btn-group">
										<button type="button" data-comanda_id={{comanda.id}} class="js-apri-comanda btn btn-default">Apri</button>
											<div class="btn-group">
											<button type="button" class="btn btn-default dropdown-toggle dropdown-icon" data-toggle="dropdown">
											</button>
											<div class="dropdown-menu">
												<a data-comanda_id={{comanda.id}} class="dropdown-item js-elimina-comanda text-danger" href="#">Elimina</a>
											</div>
										</div>
									</div>
								</td>
							</tr>
						{%endfor%}
						</tbody>
					</table>
					</div>
					<h5>TOTALE: {{a}} € (di {{b}} €)</h5>
				</div>
			</div>
		</div>
	  <!-- /.col-md-6 -->
	</div>
	<!-- /.row -->
{% endblock %}



{% block scripts_page %}
    <script>
	$(document).ready(function() {	
		$(".js-apri-comanda").click(function(e) {
			document.location.href = site.uri.public+'/comanda/'+$(this).data('comanda_id');
		});
	
	
		$(".js-nuova-comanda").click(function(e) {
			$("body").ufModal({
				sourceUrl: site.uri.public + "/modals/comande/nuova-comanda",
				msgTarget: $("#alerts-page")
			});
			$("body").on('renderSuccess.ufModal', function() {
				var modal = $(this).ufModal('getModal');
				var form = modal.find('.js-form');
				form.ufForm()
					.on("submitSuccess.ufForm", function(event, data, textStatus, jqXHR) {
						document.location.href = site.uri.public+'/comanda/'+data[0];
					});
			});
        });
		$(".js-cambia-evento-corrente").click(function(e) {
			$("body").ufModal({
				sourceUrl: site.uri.public + "/modals/comande/cambia-evento-corrente",
				msgTarget: $("#alerts-page")
			});
			$("body").on('renderSuccess.ufModal', function() {
				var modal = $(this).ufModal('getModal');
				var form = modal.find('.js-form');
				form.ufForm()
					.on("submitSuccess.ufForm", function(event, data, textStatus, jqXHR) {
						window.location.reload();
					});
			});
        });
		$(".js-elimina-comanda").click(function(e) {
			$("body").ufModal({
				sourceUrl: site.uri.public + "/modals/comande/elimina-comanda/"+$(this).data('comanda_id'),
				msgTarget: $("#alerts-page")
			});
			$("body").on('renderSuccess.ufModal', function() {
				var modal = $(this).ufModal('getModal');
				var form = modal.find('.js-form');
				form.ufForm()
					.on("submitSuccess.ufForm", function(event, data, textStatus, jqXHR) {
						window.location.reload();
					});
			});
        });
		

	});
    </script>
{% endblock %}
